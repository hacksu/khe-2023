name: CI/CD

on:
  workflow_dispatch:
  push:
    branches:
      - "actions-improvements"

jobs:
  lint:
    name: Lint
    uses: hacksu/khe-2023/.github/workflows/lint.yml@actions-improvements

  build:
    name: Build
    needs: [lint]
    uses: hacksu/khe-2023/.github/workflows/build.yml@actions-improvements

  publish-debug:
    name: Publish - Debug
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/actions-improvements'
    needs: [build]
    steps:
      - name: Test
        run: echo ${{ needs.build.outputs.publish }}

  publish:
    name: Publish
    if: github.ref == 'refs/heads/actions-improvements' && needs.build.outputs.publish
    needs: [build]
    uses: hacksu/khe-2023/.github/workflows/publish.yml@actions-improvements
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}